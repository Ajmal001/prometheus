window.Prometheus=function(){function e(){var a=document.createElement("script");a.setAttribute("type","text/javascript"),a.setAttribute("src","https://vingkan.github.io/prometheus/script/html2canvas.min.js"),document.getElementsByTagName("head")[0].appendChild(a)}function g(a){var b=firebase.database().ref("prometheus"+a);return b}function i(a){var b={location:{},country:{}},c=new XMLHttpRequest;c.open("GET","https://geoip.nekudo.com/api/",!1);try{c.send();var d=c.responseText;b=JSON.parse(d)}catch(a){}a&&a(b)}function j(a){h.latitude=a.location.latitude,h.longitude=a.location.longitude,h.city=a.city,h.country=a.country.name,h.ip=a.ip,h.isValid=null!=h.latitude}function k(){var a="NO_GEOLOCATION_EXCEPTION";return h.isValid&&(a={latitude:h.latitude,longitude:h.longitude,city:h.city,country:h.country,ip:h.ip}),a}function l(){return{timestamp:Date.now(),timezoneOffset:(new Date).getTimezoneOffset()}}function m(){function a(){var a=!1;return function(b){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(b)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(b.substr(0,4)))&&(a=!0)}(navigator.userAgent||navigator.vendor||window.opera),a}function b(){var a=!1;return function(b){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(b)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(b.substr(0,4)))&&(a=!0)}(navigator.userAgent||navigator.vendor||window.opera),a}var c="desktop";a()?c="mobile":b()&&(c="tablet");var e,d=navigator.userAgent,f=d.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if(/trident/i.test(f[1]))return e=/\brv[ :]+(\d+)/g.exec(d)||[],{name:"IE",version:e[1]||""};if("Chrome"===f[1]&&(e=d.match(/\bOPR\/(\d+)/),null!=e))return{name:"Opera",version:e[1]};f=f[2]?[f[1],f[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(e=d.match(/version\/(\d+)/i))&&f.splice(1,1,e[1]);var g=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,h=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;return{device:c,name:f[0],version:f[1],width:g,height:h}}function n(){return{title:document.title,url:location.href}}function o(a){var b;switch(a){case"location":b=k();break;case"datetime":b=l();break;case"browser":b=m();break;case"page":b=n();break;case"all":b={location:k(),datetime:l(),browser:m(),page:n()};break;default:b="BAD_REQUEST_EXCEPTION"}return b}function p(a){"Notification"in window?"granted"===Notification.permission?q(a):"denied"!==Notification.permission?Notification.requestPermission(function(b){"granted"===b&&q(a)}):console.warn("Notification permissions rejected."):console.warn("Notifications not supported.")}function q(a){if(a.message){a.icon||(a.icon="http://vingkan.github.io/prometheus/img/contrast-logo.png");var b=new Notification(a.message,a);a.clickFn&&(b.onclick=function(b){b.preventDefault(),a.clickFn()})}else var b=new Notification(a)}var a,b,c=!1,f=function(d){firebase.initializeApp(d),b=!0,b&&i(j),d.localhost&&d.localhost===!0&&(c=!0),d.noScreenshots&&d.noScreenshots===!0?a=!1:(a=!0,e());var f={trackUser:function(a){a&&localStorage.setItem("prometheus_user",a)},getUID:function(){var a="ANONYMOUS_USER";return this.isTrackingUser()&&(a=localStorage.getItem("prometheus_user")),a},save:function(a,b){var d=this.getUID(),e=a||{type:"SAVED_VISIT"},f=b||"all",h=this.get(f);if(c===!1&&h.page.url.indexOf("localhost")>-1);else{var i=g("/visits/"+d);i.push({meta:h,visit:e})}},error:function(a){var b={type:"ERROR",message:a.message,url:a.url,line:a.line};this.capture(b)},logon:function(a,b,d){if(a){if(this.trackUser(a),c===!1&&location.hostname.indexOf("localhost")>-1);else if(b){var e=g("/users/"+a+"/profile");e.set(b)}this.loadFeatures(),this.save({type:"USER_LOGON"},d)}},capture:function(b){var b=b||{};b.type||(b.type="SCREEN_CAPTURE");var c=this;a?html2canvas(window.parent.document.body,{onrendered:function(a){a.style.display="none",document.body.appendChild(a);var d=a.toDataURL("image/png");b.img=d,c.save(b)}}):(b.img_note="NONE_TAKEN",this.save(b))},isTrackingUser:function(){var a=!1,b=localStorage.getItem("prometheus_user");return b&&(a=!0),a},loadFeatures:function(){var a=this.getUID(),b=g("/features");b.on("value",function(b){var c=b.val(),d=[];for(var e in c)if(c[e]){var f=c[e];for(var g in f.access)f.access[g]&&f.access[g]===a&&d.push(e)}localStorage.setItem("prometheus_features",d)})},has:function(a){var b=!1,c=localStorage.getItem("prometheus_features")||"",d=c.split(",");return d.indexOf(a)>-1&&(b=!0),b},get:function(a){var b={};if(Array.isArray(a)&&a.length>0)if(a.indexOf("all")>-1)b=o("all");else for(var c=0;c<a.length;c++){var d=a[c];b[d]=o(d)}else b=a?o(a):"BAD_REQUEST_EXCEPTION";return b},can:function(a,b,c){var d=this.getUID(),e=g("/features/"+a+"/");e.once("value",function(e){if(e.exists()){var f=e.val(),h=g("/users/"+d+"/data");h.once("value",function(d){var e={};d.exists()&&(e=d.val());var g={};if(f.validate){var h=new Function("userData",f.validate);g=h(e)}else c&&c({message:"The feature could not be validated.",featureID:a});g.allowed?b&&b(g.data):c&&c(g.data)})}else c&&c({message:"The feature you requested does not exist.",featureID:a})})},deliver:function(a,b,c){f.can(a,function(d){var e=f.getUID(),h=g("/features/"+a+"/");h.once("value",function(f){if(f.exists()){var h=f.val(),i=g("/users/"+e+"/data");i.once("value",function(a){var c={};a.exists()&&(c=a.val());var e={};if(h.process){var f=new Function("userData",h.process);e=f(c),i.set(c)}else e.data=d;b&&b(e.data)})}else c&&c({message:"The feature you requested does not exist.",featureID:a})})},function(a){c&&c(a)})},redeem:function(a,b,c,d){var e=d||{},h=this.getUID(),i=g("/users/"+h+"/data/");i.once("value",function(d){var h={};d.exists()&&(h=d.val());var j=[];if(h.hasOwnProperty("promos")&&(j=h.promos),j.indexOf(a)<0){var k=g("/promos/"+a+"/");k.once("value",function(d){if(d.exists()&&d.val().hasOwnProperty("redeem")){var e=d.val(),g=new Function("userData",e.redeem);j.push(a),h.promos=j,i.set(g(h)),f.save({type:"PROMO_CODE_USED",code:a}),b&&b(e.info)}else f.save({type:"PROMO_CODE_ERROR",code:a,error:"NOT_FOUND"}),c&&c({type:"NOT_FOUND",message:"Promo code not found."})})}else e.silent||f.save({type:"PROMO_CODE_ERROR",code:a,error:"ALREADY_USED"}),c&&c({type:"ALREADY_USED",message:"Promo code already used."})})},Note:function(a){var b=this;return{seen:function(c){var d=c||{};d.type="NOTIFICATION_CLICKED",d.noteid=a,b.save(d)},terminate:function(c){var d=b.getUID(),e=g("/users/"+d+"/data/"+a);e.once("value",function(d){if(d.exists()){e.remove();var f=c||{};f.type="NOTIFICATION_TERMINATED",f.noteid=a,b.save(f)}})}}},notify:function(a,b,c){var e=this;this.deliver(a,function(){p({message:b.title||"Alert",body:b.message||"",icon:b.icon||d.icon||null,clickFn:function(){var b=e.Note(a);c?c(b):b.seen()}})})},timers:{},Timer:function(a){var b=this;return{id:a,data:{},started:!1,start:function(a){this.started||(this.started=Date.now(),a&&(this.data=a))},stop:function(c){if(this.started){var d={type:"TIMER",timerID:this.id,start:this.started,end:Date.now()};for(var e in this.data)this.data.hasOwnProperty(e)&&(d[e]=this.data[e]);for(var f in c)c.hasOwnProperty(f)&&(d[f]=c[f]);b.save(d),b.timers[a]=null}}}},timer:function(a){return this.timers[a]||(this.timers[a]=this.Timer(a)),this.timers[a]},toString:function(){return console.log(d),"Bringing Firebase to humanity!"}};return window.onerror=function(a,b,c){console.warn("Error recorded by Prometheus.js."),f.error({message:a,url:b,line:c})},f.loadFeatures(),f},h={latitude:0,longitude:0,isValid:!1};return f}();